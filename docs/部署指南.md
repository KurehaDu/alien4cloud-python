# Alien4Cloud Python 部署指南

## 系统要求

- Ubuntu 22.04 LTS
- 最小配置：
  - CPU: 2核
  - 内存: 4GB
  - 磁盘: 20GB
- 推荐配置：
  - CPU: 4核
  - 内存: 8GB
  - 磁盘: 50GB
- 网络要求：
  - 内网部署：无特殊要求
  - 公网访问：需要固定公网IP
  - 防火墙端口：22(SSH)、80(HTTP)、8088(API)

## 快速部署

### 1. 获取部署脚本

```bash
git clone https://github.com/KurehaDu/alien4cloud-python.git
cd alien4cloud-python
```

### 2. 执行部署脚本

#### 本地部署（仅内网访问）

```bash
sudo ./scripts/deploy.sh
```

### 3. 启动服务

```bash
sudo systemctl start alien4cloud
sudo systemctl enable alien4cloud  # 设置开机自启
```

## 部署选项说明

部署脚本支持以下选项：

```
-h, --help                显示帮助信息
-i, --install-dir DIR     指定安装目录 (默认: /opt/alien4cloud)
-d, --data-dir DIR        指定数据目录 (默认: /var/lib/alien4cloud)
-l, --log-dir DIR         指定日志目录 (默认: /var/log/alien4cloud)
-u, --user USER           指定运行用户 (默认: alien4cloud)
-g, --group GROUP         指定运行用户组 (默认: alien4cloud)
-p, --port PORT           指定API端口 (默认: 8088)
--ui-port PORT            指定UI端口 (默认: 8080)
--skip-deps               跳过依赖安装
--max-retries N          最大重试次数 (默认: 3)
--retry-interval N       重试间隔(秒) (默认: 5)
```

## 访问方式

### 本地部署
- Web界面：http://localhost:8080
- API接口：http://localhost:8088

## 安全配置

### 1. 防火墙配置

部署脚本会自动配置基本的防火墙规则：
- 允许SSH访问（22端口）
- 允许HTTP访问（80端口）
- 允许API访问（8088端口）

如需手动配置：

```bash
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow ${PORT}/tcp
sudo ufw enable
```

### 2. 访问控制

默认配置已包含基本的安全头部：
- X-Frame-Options
- X-XSS-Protection
- X-Content-Type-Options

## 常见问题

1. 部署失败
   - 检查系统要求是否满足
   - 检查网络连接
   - 查看日志：`/var/log/alien4cloud/deploy.log`

2. 无法访问服务
   - 检查服务状态：`systemctl status alien4cloud`
   - 检查Nginx状态：`systemctl status nginx`
   - 检查防火墙规则：`ufw status`
   - 检查日志：`/var/log/alien4cloud/app.log`

3. 访问控制问题
   - 确保配置文件中的allowed_hosts设置正确

## 维护指南

### 1. 查看日志

```bash
# 应用日志
tail -f /var/log/alien4cloud/app.log

# Nginx访问日志
tail -f /var/log/nginx/access.log

# Nginx错误日志
tail -f /var/log/nginx/error.log
```

### 2. 备份数据

```bash
# 备份数据目录
sudo tar -czf alien4cloud_data_$(date +%Y%m%d).tar.gz /var/lib/alien4cloud

# 备份配置
sudo tar -czf alien4cloud_config_$(date +%Y%m%d).tar.gz /opt/alien4cloud/config
```

### 3. 更新服务

```bash
# 停止服务
sudo systemctl stop alien4cloud

# 更新代码
cd /opt/alien4cloud
git pull

# 更新依赖
pip install -r requirements.txt

# 启动服务
sudo systemctl start alien4cloud
```

### 4. 清理历史数据

```bash
# 清理日志
sudo find /var/log/alien4cloud -name "*.log.*" -mtime +30 -delete

# 清理临时文件
sudo find /var/lib/alien4cloud/tmp -mtime +7 -delete
```